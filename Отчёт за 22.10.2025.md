# Отчёт по практике

**Сервис сокращения ссылок**

## Цели и задачи

### Задачи:
- [x] Реализовать базовое сокращение ссылок
- [x] Организовать хранение данных в SQLite
- [x] Реализовать систему перенаправлений
- [x] Добавить сбор статистики переходов
- [x] Создать автоматическую документацию API
- [x] Обеспечить валидацию входных данных

## Технологический стек

| Компонент | Назначение |
|-----------|------------|
| **FastAPI** | Основной веб-фреймворк |
| **SQLite** | База данных для хранения ссылок |
| **SQLAlchemy** | ORM для работы с базой данных |
| **Pydantic** | Валидация данных и сериализация |
| **Uvicorn** | ASGI-сервер для запуска приложения |
| **Python-multipart** | Обработка форм данных |

## Архитектура приложения

### Структура проекта:
```
url_shortener/
├── main.py              # Основной файл приложения
├── database.py          # Настройка базы данных
├── models.py            # Модели SQLAlchemy
├── schemas.py           # Pydantic схемы
├── crud.py              # Бизнес-логика (CRUD операции)
└── requirements.txt     # Зависимости проекта
```

### Модель данных:
```python
class URL(Base):
    __tablename__ = "urls"
    
    id = Column(Integer, primary_key=True, index=True)
    original_url = Column(String, index=True)
    short_code = Column(String, unique=True, index=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    click_count = Column(Integer, default=0)
```

## Функциональность

### 1. Создание короткой ссылки
**Эндпоинт:** `POST /shorten`

Принимает оригинальный URL и возвращает короткий код:
```json
{
  "original_url": "https://example.com/very/long/url/path",
  "short_code": "abc123"
}
```

### 2. Перенаправление по короткой ссылке
**Эндпоинт:** `GET /{short_code}`

Выполняет HTTP-редирект (код 307) на оригинальный URL и увеличивает счетчик переходов.

### 3. Просмотр статистики
**Эндпоинт:** `GET /{short_code}/stats`

Возвращает информацию о ссылке:
```json
{
  "original_url": "https://example.com/very/long/url/path",
  "short_code": "abc123",
  "created_at": "2024-01-15T10:30:00",
  "click_count": 42
}
```

## Установка и запуск

### 1. Установка зависимостей
```bash
pip install fastapi uvicorn sqlalchemy python-multipart
```

### 2. Запуск приложения
```bash
uvicorn main:app --reload
```

### 3. Доступ к документации
После запуска приложения доступна автоматическая документация:
- Swagger UI: http://127.0.0.1:8000/docs
- ReDoc: http://127.0.0.1:8000/redoc

## Примеры использования

### Создание короткой ссылки:
```bash
curl -X POST "http://127.0.0.1:8000/shorten" \
     -H "Content-Type: application/json" \
     -d '{"original_url": "https://example.com/very/long/path"}'
```

**Ответ:**
```json
{
  "original_url": "https://example.com/very/long/path",
  "short_code": "aBcDeF",
  "short_url": "http://127.0.0.1:8000/aBcDeF"
}
```

### Просмотр статистики:
```bash
curl "http://127.0.0.1:8000/aBcDeF/stats"
```

**Ответ:**
```json
{
  "original_url": "https://example.com/very/long/path",
  "short_code": "aBcDeF",
  "created_at": "2024-01-15T10:30:00.000000",
  "click_count": 5
}
```

## Ключевые особенности реализации

### 1. Генерация коротких кодов
```python
def generate_short_code(length: int = 6) -> str:
    """Генерирует случайный короткий код"""
    return ''.join(secrets.choice(string.ascii_letters + string.digits) 
                  for _ in range(length))
```

### 2. Валидация URL
```python
from pydantic import HttpUrl

class URLBase(BaseModel):
    original_url: HttpUrl
```

### 3. Обработка перенаправлений
```python
@app.get("/{short_code}")
async def redirect_to_url(short_code: str, db: Session = Depends(get_db)):
    db_url = crud.get_url_by_short_code(db, short_code)
    if db_url:
        # Увеличиваем счетчик кликов
        crud.increment_click_count(db, db_url)
        return RedirectResponse(url=str(db_url.original_url))
    raise HTTPException(status_code=404, detail="URL not found")
```

Разработанное приложение успешно демонстрирует практическое применение современных технологий Python для создания веб-сервисов и может служить основой для более сложных проектов.